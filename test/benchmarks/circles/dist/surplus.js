!function(){"use strict";function n(e,t,r){var o=typeof t;if(r===t);else if("string"===o)r=""!==r&&"string"==typeof r?e.firstChild.data=t:e.textContent=t;else if("number"===o)t=t.toString(),r=""!==r&&"string"==typeof r?e.firstChild.data=t:e.textContent=t;else if(null==t||"boolean"===o)f(e),r="";else if("function"===o)p(function(){r=n(e,t(),r)});else if(t instanceof Node)Array.isArray(r)?0===r.length?e.appendChild(t):1===r.length?e.replaceChild(t,r[0]):(f(e),e.appendChild(t)):""===r?e.appendChild(t):e.replaceChild(t,e.firstChild),r=t;else{if(!Array.isArray(t))throw new Error("content must be Node, stringable, or array of same");var l=function n(e,t){for(var r=0,o=t.length;r<o;r++){var l=t[r];l instanceof Node?e.push(l):null==l||!0===l||!1===l||(Array.isArray(l)?n(e,l):"string"==typeof l?e.push(l):e.push(l.toString()))}return e}([],t);0===l.length?f(e):Array.isArray(r)?0===r.length?a(e,l,0,l.length):i(e,r,l):""===r?a(e,l,0,l.length):i(e,[e.firstChild],l),r=l}return r}var e=-1,t=-2,r=0,o=16,l=1<<o,u=l-1;function i(n,i,a){var d,p,g,v=a.length,w=0,m=i.length-1,y=0,C=v-1,b=i[w],k=a[y],x=i[m],A=a[C],_=x.nextSibling,N=!0;n:for(;N;){for(N=!1;s(k,b,y,a);){if(w++,++y>C||w>m)break n;k=a[y],b=i[w]}for(;s(A,x,C,a);){if(_=x,m--,y>--C||w>m)break n;A=a[C],x=i[m]}for(;s(k,x,y,a);){if(N=!0,n.insertBefore(x,b),m--,++y>C||w>m)break n;k=a[y],x=i[m]}for(;s(A,b,C,a);){if(N=!0,null===_?n.appendChild(b):n.insertBefore(b,_),_=b,w++,y>--C||w>m)break n;A=a[C],b=i[w]}}if(y>C)for(;w<=m;)n.removeChild(i[m]),m--;else if(w>m)for(;y<=C;)c(n,a[y],_,y,a),y++;else{var E=[];for(d=w,p=(w<<o)+(r=(r+1)%l);d<=m;d++,p+=l)void 0===(b=i[d]).__surplus_order?Object.defineProperty(b,"__surplus_order",{value:p,writable:!0}):b.__surplus_order=p,b instanceof Text&&E.push(d);var B=new Array(C-y+1),j=[],S=0;for(d=y;d<=C;d++)"string"==typeof(k=a[d])?(j.push(d),B[d-y]=e):void 0!==(p=k.__surplus_order)&&(p&u)===r?(p>>=o,B[d-y]=p,i[p]=null,S++):B[d-y]=e;if(0!==S||0!==w||m!==i.length-1){var T=function(n){for(var e=[],t=[],r=-1,o=new Array(n.length),l=0,u=n.length;l<u;l++){var i=n[l];if(!(i<0)){var s=h(e,i);-1!==s&&(o[l]=t[s]),s===r?(e[++r]=i,t[r]=l):i<e[s+1]&&(e[s+1]=i,t[s+1]=l)}}for(l=t[r];r>=0;l=o[l],r--)e[r]=l;return e}(B);for(d=0;d<T.length;d++)B[T[d]]=t;var M=0,O=0,z=0;for(d=0,p=0,g=0;d<j.length;d++){for(M=j[d];p<T.length&&(O=T[p])<M-y;)p++;for(;g<E.length&&(z=E[g],0!==p)&&z<B[T[p-1]];)g++;g<E.length&&(p===T.length||z<B[O])?(b=i[z],k=a[M],b.data!==k&&(b.data=k),i[z]=null,a[M]=b,B[M]=t,g++):a[M]=document.createTextNode(a[M])}for(;w<=m;)null!==(b=i[w])&&n.removeChild(b),w++;for(;y<=C;)A=a[C],B[C-y]!==t&&(null===_?n.appendChild(A):n.insertBefore(A,_)),_=A,C--}else for(f(n);y<=C;)c(n,a[y],null,y,a),y++}}function s(n,e,t,r){return n===e||"string"==typeof n&&e instanceof Text&&(e.data!==n&&(e.data=n),r[t]=e,!0)}function a(n,e,t,r){for(var o;t<r;t++)(o=e[t])instanceof Node?n.appendChild(o):(o=e[t]=document.createTextNode(o),n.appendChild(o))}function c(n,e,t,r,o){"string"==typeof e&&(e=o[r]=document.createTextNode(e)),null===t?n.appendChild(e):n.insertBefore(e,t)}function f(n){n.textContent=""}function h(n,e){var t=-1,r=n.length;if(r>0&&n[r-1]<=e)return r-1;for(;r-t>1;){var o=Math.floor((t+r)/2);n[o]>e?r=o:t=o}return t}function d(n,e,t){var r=document.createElement(n);return e&&(r.className=e),t&&t.appendChild(r),r}new RegExp("^("+Object.keys({xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"}).join("|")+")-(.*)");var p=function(n,e){var t=new m(n,e);return function(){return t.current()}};Object.defineProperty(p,"default",{value:p}),p.root=function(n){var e=B,t=0===n.length?j:new m(null,null),r=void 0,o=0===n.length?null:function(){null!==N?_.disposes.add(t):R(t)};return B=t,null===N?r=function(n,e,t){try{return null===e?n():n(e)}finally{B=t}}(n,o,e):(r=null===o?n():n(o),B=e),r},p.on=function(n,e,t,r){var o;return Array.isArray(n)&&(o=n,n=function(){for(var n=0;n<o.length;n++)o[n]()}),r=!!r,p(l,t);function l(t){var o=E;return n(),r?r=!1:(E=null,t=e(t),E=o),t}},p.effect=function(n,e){new m(n,e)},p.data=function(n){var e=new w(n);return function(n){return 0===arguments.length?e.current():e.next(n)}},p.value=function(n,e){var t=p.data(n),r=-1;return function(o){if(0===arguments.length)return t();if(!(e?e(n,o):n===o)){var l=_.time;if(r===l)throw new Error("conflicting values: "+o+" is not the same as "+n);r=l,n=o,t(o)}return o}},p.freeze=function(n){var e=void 0;if(null!==N)e=n();else{(N=_).changes.reset();try{e=n(),T()}finally{N=null}}return e},p.sample=function(n){var e,t=E;return null!==t?(E=null,e=n(),E=t):e=n(),e},p.cleanup=function(n){null!==B?null===B.cleanups?B.cleanups=[n]:B.cleanups.push(n):console.warn("cleanups created without a root or parent will never be run")},p.makeDataNode=function(n){return new w(n)},p.makeComputationNode=function(n,e){return new m(n,e)},p.isFrozen=function(){return null!==N},p.isListening=function(){return null!==E};var g=function(){return function(){this.time=0,this.changes=new C,this.updates=new C,this.disposes=new C}}(),v={time:function(){return _.time}},w=function(){function n(n){this.value=n,this.pending=b,this.log=null}return n.prototype.current=function(){return null!==E&&function(n,e){null===n.log&&(n.log=new y);S(n.log,e)}(this,E),this.value},n.prototype.next=function(n){if(null!==N)if(this.pending!==b){if(n!==this.pending)throw new Error("conflicting changes: "+n+" !== "+this.pending)}else this.pending=n,_.changes.add(this);else null!==this.log?(this.pending=n,_.changes.add(this),T()):this.value=n;return n},n.prototype.clock=function(){return v},n}(),m=function(){function n(n,e){if(this.state=k,this.source1=null,this.source1slot=0,this.sources=null,this.sourceslots=null,this.log=null,this.owned=null,this.cleanups=null,this.fn=n,this.value=e,this.age=_.time,null!==n){var t=B,r=E;null===t&&console.warn("computations created without a root or parent will never be disposed"),B=E=this,null===N?function(n){N=_,_.changes.reset(),_.updates.reset();try{n.value=n.fn(n.value),(_.changes.count>0||_.updates.count>0)&&(_.time++,M(_))}finally{N=B=E=null}}(this):this.value=this.fn(this.value),t&&t!==j&&(null===t.owned?t.owned=[this]:t.owned.push(this)),B=t,E=r}}return n.prototype.current=function(){if(null!==E){if(this.age===_.time){if(this.state===A)throw new Error("circular dependency");P(this)}!function(n,e){null===n.log&&(n.log=new y);S(n.log,e)}(this,E)}return this.value},n.prototype.clock=function(){return v},n}(),y=function(){return function(){this.node1=null,this.node1slot=0,this.nodes=null,this.nodeslots=null}}(),C=function(){function n(){this.items=[],this.count=0}return n.prototype.reset=function(){this.count=0},n.prototype.add=function(n){this.items[this.count++]=n},n.prototype.run=function(n){for(var e=this.items,t=0;t<this.count;t++)n(e[t]),e[t]=null;this.count=0},n}(),b={},k=0,x=1,A=2,_=new g,N=null,E=null,B=null,j=new m(null,null);function S(n,e){var t,r=null===e.source1?-1:null===e.sources?0:e.sources.length;null===n.node1?(n.node1=e,n.node1slot=r,t=-1):null===n.nodes?(n.nodes=[e],n.nodeslots=[r],t=0):(t=n.nodes.length,n.nodes.push(e),n.nodeslots.push(r)),null===e.source1?(e.source1=n,e.source1slot=t):null===e.sources?(e.sources=[n],e.sourceslots=[t]):(e.sources.push(n),e.sourceslots.push(t))}function T(){var n=B;_.updates.reset(),_.time++;try{M(_)}finally{N=E=null,B=n}}function M(n){var e=N,t=0;for(N=n,n.disposes.reset();0!==n.changes.count||0!==n.updates.count||0!==n.disposes.count;)if(t>0&&n.time++,n.changes.run(O),n.updates.run(P),n.disposes.run(R),t++>1e5)throw new Error("Runaway clock detected");N=e}function O(n){n.value=n.pending,n.pending=b,n.log&&z(n.log)}function z(n){var e=n.node1,t=n.nodes;if(null!==e&&F(e),null!==t)for(var r=0,o=t.length;r<o;r++)F(t[r])}function F(n){var e=_.time;n.age<e&&(n.age=e,n.state=x,_.updates.add(n),null!==n.owned&&function n(e){for(var t=0;t<e.length;t++){var r=e[t];r.age=_.time,r.state=k,null!==r.owned&&n(r.owned)}}(n.owned),null!==n.log&&z(n.log))}function P(n){if(n.state===x){var e=B,t=E;B=E=n,n.state=A,$(n,!1),n.value=n.fn(n.value),n.state=k,B=e,E=t}}function $(n,e){var t,r,o=n.source1,l=n.sources,u=n.sourceslots,i=n.cleanups,s=n.owned;if(null!==i){for(t=0;t<i.length;t++)i[t](e);n.cleanups=null}if(null!==s){for(t=0;t<s.length;t++)R(s[t]);n.owned=null}if(null!==o&&(L(o,n.source1slot),n.source1=null),null!==l)for(t=0,r=l.length;t<r;t++)L(l.pop(),u.pop())}function L(n,e){var t,r,o=n.nodes,l=n.nodeslots;-1===e?n.node1=null:(t=o.pop(),r=l.pop(),e!==o.length&&(o[e]=t,l[e]=r,-1===r?t.source1slot=e:t.sourceslots[r]=e))}function R(n){n.fn=null,n.log=null,$(n,!0)}function D(n){const e=++n.count;n.top(10*Math.sin(e/10)),n.left(10*Math.cos(e/10)),n.color(e%255),n.content(e%100)}const I=()=>{const e=function(n){const e=[];for(let t=0;t<n;t++)e.push({top:p.data(0),left:p.data(0),content:p.data(0),color:p.data(),count:0});return e}(Benchmark.number);return Benchmark.Framework.Surplus.loop=(()=>Promise.resolve().then(()=>p.freeze(()=>e.forEach(D)))),e.map((e,t)=>(function(){var r,o;return r=d("div","box-view",null),o=d("div",null,r),p.effect(function(t){return n(o,e.content(),t)},""),p.effect(function(){o.className="box",o.id=t,function(n,e){for(var t=Object.keys(e),r=0,o=t.length;r<o;r++){var l=t[r];n[l]=e[l]}}(o.style,{top:`${e.top()}px`,left:`${e.left()}px`,background:`rgb(0,0,${e.color()})`})}),r})())};let X;Benchmark.Framework.Surplus={start(){p.root(n=>{X=n;const e=document.getElementById("grid");I().forEach(n=>e.appendChild(n))})},cleanup(){X&&X()}}}();
